<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ - Full Mark</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { background-color: #030508; color: white; font-family: 'Cairo', sans-serif; }
        .login-input-container {
            background-color: #11141d; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease;
        }
        .login-input-container:focus-within {
            border-color: #00f5c4; box-shadow: 0 0 20px rgba(0, 245, 196, 0.15); background-color: #161b26;
        }
        .logo-text { direction: ltr; display: inline-flex; gap: 4px; }
        .neon-glow { box-shadow: 0 0 25px rgba(0, 245, 196, 0.4); }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
</head>
<body>

    <div id="root"></div>

    <script type="module">
        // 1. Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ù…ÙƒØªØ¨Ø§Øª Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";

        // 2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨ÙŠÙƒ
        const firebaseConfig = {
            apiKey: "AIzaSyBKY38XHjmC-iGqGrQio_YZ_i1iaIaE2Ds",
            authDomain: "full-mark-8d434.firebaseapp.com",
            projectId: "full-mark-8d434",
            storageBucket: "full-mark-8d434.firebasestorage.app",
            messagingSenderId: "802579483999",
            appId: "1:802579483999:web:cf73136ffbd75d5e0ebaea",
            measurementId: "G-26F9W89TB8"
        };

        // 3. ØªØ´ØºÙŠÙ„ Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const analytics = getAnalytics(app);

        // Ø¬Ø¹Ù„ Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…ØªØ§Ø­Ø© Ù„Ù„Ø±ÙŠØ§ÙƒØª (Global Function)
        window.checkStudentCode = async (code) => {
            try {
                // Ø¨Ù†Ø¨Ø­Ø« ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ø³Ù…Ù‡Ø§ 'students' Ø¹Ù† ÙˆØ«ÙŠÙ‚Ø© ÙÙŠÙ‡Ø§ Ø­Ù‚Ù„ 'code' Ø¨ÙŠØ³Ø§ÙˆÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¯Ø®Ù„
                const q = query(collection(db, "students"), where("code", "==", code));
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    // Ø§Ù„ÙƒÙˆØ¯ ØµØ­ ÙˆÙ…ÙˆØ¬ÙˆØ¯
                    return { success: true, data: querySnapshot.docs[0].data() };
                } else {
                    // Ø§Ù„ÙƒÙˆØ¯ ØºÙ„Ø·
                    return { success: false };
                }
            } catch (error) {
                console.error("Error logging in: ", error);
                return { success: false, error: error };
            }
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function LoginPage() {
            useEffect(() => lucide.createIcons(), []);

            const [code, setCode] = useState("");
            const [loading, setLoading] = useState(false);
            const [errorMsg, setErrorMsg] = useState("");

            const handleLogin = async (e) => {
                e.preventDefault();
                setLoading(true);
                setErrorMsg("");

                // Ù‡Ù†Ø§ Ø¨Ù†Ù†Ø§Ø¯ÙŠ Ø¹Ù„Ù‰ Ø¯Ø§Ù„Ø© Firebase Ø§Ù„Ù„ÙŠ Ø¹Ù…Ù„Ù†Ø§Ù‡Ø§ ÙÙˆÙ‚
                if (window.checkStudentCode) {
                    const result = await window.checkStudentCode(code.trim());
                    
                    if (result.success) {
                        // Ù„Ùˆ Ø§Ù„ÙƒÙˆØ¯ ØµØ­:
                        // 1. Ø§Ø­ÙØ¸ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ Ø¹Ø´Ø§Ù† ÙŠÙØ¶Ù„ Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„
                        localStorage.setItem('studentCode', code);
                        localStorage.setItem('studentData', JSON.stringify(result.data));
                        
                        // 2. ÙˆØ¯ÙŠÙ‡ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ù…Ù†ØµØ© (ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù ØµØ­)
                        alert(`Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙŠÙƒ ÙŠØ§ ${result.data.name || 'Ø¨Ø·Ù„'}! Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„...`);
                        window.location.href = 'platform.html'; // ØºÙŠØ± Ø¯ÙŠ Ù„Ø§Ø³Ù… ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ø¨ØªØ§Ø¹ØªÙƒ
                    } else {
                        // Ù„Ùˆ Ø§Ù„ÙƒÙˆØ¯ ØºÙ„Ø·
                        setErrorMsg("Ø§Ù„ÙƒÙˆØ¯ Ø¯Ù‡ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯ Ø£Ùˆ ØºÙ„Ø·. Ø§ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù†!");
                    }
                } else {
                    setErrorMsg("Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….");
                }
                setLoading(false);
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center px-4 relative overflow-hidden">
                    
                    <div className="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-[#00f5c4]/5 blur-[120px] rounded-full pointer-events-none"></div>
                    <div className="absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-[#00f5c4]/5 blur-[120px] rounded-full pointer-events-none"></div>

                    <div className="w-full max-w-md z-10">
                        
                        <div className="flex flex-col items-center mb-10">
                            <div className="flex items-center gap-3 mb-6">
                                <h2 className="logo-text text-3xl font-black italic tracking-tighter text-white">
                                    FULL <span className="text-[#00f5c4]">MARK</span>
                                </h2>
                                <img src="https://i.postimg.cc/2ys9RdV5/IMG-20260207-221213-980.jpg" alt="Logo" className="w-12 h-12 rounded-xl border border-white/10 shadow-lg" />
                            </div>

                            <h1 className="text-4xl font-black mb-2 flex items-center gap-2">
                                Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙŠÙƒ ÙŠØ§ Ø¨Ø·Ù„! <span className="animate-pulse">ğŸ‘‹</span>
                            </h1>
                            <p className="text-gray-400 font-medium">
                                Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø¹Ø´Ø§Ù† ØªÙƒÙ…Ù„ Ø±Ø­Ù„Ø© Ø§Ù„ØªÙÙˆÙ‚ <span className="text-[#00f5c4]">Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</span>
                            </p>
                        </div>

                        <form onSubmit={handleLogin} className="space-y-6">
                            
                            <div>
                                <label className="block text-gray-400 text-sm mb-2 font-bold mr-1">ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                                <div className={`login-input-container rounded-2xl flex items-center px-4 py-4 ${errorMsg ? 'border-red-500 bg-red-500/5' : ''}`}>
                                    <i data-lucide="key" className={`shrink-0 ml-2 ${errorMsg ? 'text-red-500' : 'text-gray-500'}`} width="22"></i>
                                    <input 
                                        type="text" 
                                        placeholder="Ø§ÙƒØªØ¨ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ù‡Ù†Ø§..."
                                        className="bg-transparent border-none outline-none text-white w-full placeholder-gray-600 font-bold text-lg tracking-wide"
                                        value={code}
                                        onChange={(e) => setCode(e.target.value)}
                                        required
                                    />
                                </div>
                                {errorMsg && <p className="text-red-500 text-sm mt-2 font-bold flex items-center gap-1"><i data-lucide="alert-circle" width="14"></i> {errorMsg}</p>}
                            </div>

                            <button 
                                type="submit"
                                disabled={loading}
                                className={`w-full bg-[#00f5c4] text-[#030508] font-black text-xl py-4 rounded-2xl hover:bg-[#00dbae] transition-all transform hover:scale-[1.02] active:scale-[0.98] neon-glow flex justify-center items-center gap-2 ${loading ? 'opacity-70 cursor-wait' : ''}`}
                            >
                                {loading ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...' : 'Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…Ù†ØµØ©'} 
                                {!loading && <i data-lucide="arrow-left" width="24" strokeWidth="3"></i>}
                            </button>

                        </form>

                        <div className="mt-10 text-center flex flex-col md:flex-row items-center justify-center gap-2 text-lg">
                            <span className="text-white font-medium">Ù„Ø³Ù‡ Ù…Ø¹ÙƒØ´ ÙƒÙˆØ¯ØŸ</span>
                            <a 
                                href="https://t.me/elgizawy9" 
                                target="_blank"
                                className="text-[#ff9f43] font-bold hover:text-[#ffb56b] transition-colors flex items-center gap-1 hover:underline decoration-2 underline-offset-4"
                            >
                                Ø§Ø´ØªØ±Ùƒ Ù…Ø¬Ø§Ù†ÙŠ Ø¯Ù„ÙˆÙ‚ØªÙŠ 
                                <i data-lucide="external-link" width="18"></i>
                            </a>
                        </div>

                    </div>
                    
                    <div className="absolute bottom-6 text-gray-600 text-xs">Developed with â¤ï¸ by ELGIZAWY</div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<LoginPage />);
    </script>
</body>
</html>
